<section id="table-of-contents" class="toc">
  <header>
    <h3><i class="fa fa-book"></i> Overview</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#r-libraries" id="markdown-toc-r-libraries">R Libraries</a></li>
  <li><a href="#about-the-data---usgs-stream-discharge-data" id="markdown-toc-about-the-data---usgs-stream-discharge-data">About the Data - USGS Stream Discharge Data</a></li>
  <li><a href="#note-its-unclear-from-this-how-the-data-were-actually-measursed-given-it-seems" id="markdown-toc-note-its-unclear-from-this-how-the-data-were-actually-measursed-given-it-seems">note: it’s unclear from this how the data were actually measursed given it seems</a>    <ul>
      <li><a href="#getting-usgs-stream-gauge-data" id="markdown-toc-getting-usgs-stream-gauge-data">Getting USGS Stream Gauge Data</a></li>
    </ul>
  </li>
  <li><a href="#insert-picture-of-guage-picture" id="markdown-toc-insert-picture-of-guage-picture">insert picture of guage! <picture>&gt;</picture></a></li>
  <li><a href="#insert-map-of-where-the-guage-is-located---leaflet" id="markdown-toc-insert-map-of-where-the-guage-is-located---leaflet">insert map of where the guage is located - leaflet?</a></li>
  <li><a href="#import-usgs-stream-discharge-data-into-r" id="markdown-toc-import-usgs-stream-discharge-data-into-r">Import USGS Stream Discharge Data Into R</a></li>
  <li><a href="#link-out-to-data-or-software-carpentry-lessons-that-teach-this" id="markdown-toc-link-out-to-data-or-software-carpentry-lessons-that-teach-this">LINK OUT TO DATA OR SOFTWARE CARPENTRY LESSONS THAT TEACH THIS??</a></li>
  <li><a href="#view-data-structure" id="markdown-toc-view-data-structure">View Data Structure</a></li>
  <li><a href="#converting-time-stamps" id="markdown-toc-converting-time-stamps">Converting Time Stamps</a></li>
  <li><a href="#no-data-values" id="markdown-toc-no-data-values">No Data Values</a></li>
  <li><a href="#plot-the-data" id="markdown-toc-plot-the-data">Plot The Data</a></li>
  <li><a href="#plot-data-time-subsets-with-ggplot" id="markdown-toc-plot-data-time-subsets-with-ggplot">Plot Data Time Subsets With GGplot</a>    <ul>
      <li><a href="#plot-a-temporal-subset" id="markdown-toc-plot-a-temporal-subset">Plot A Temporal Subset</a></li>
    </ul>
  </li>
  <li><a href="#publish-to-plotly" id="markdown-toc-publish-to-plotly">Publish to Plot.ly</a>    <ul>
      <li><a href="#time-subsets-in-plotly" id="markdown-toc-time-subsets-in-plotly">Time subsets in plot.ly</a></li>
    </ul>
  </li>
  <li><a href="#challenge-" id="markdown-toc-challenge-">Challenge ???</a></li>
  <li><a href="#left-to-do-in-this-lessson" id="markdown-toc-left-to-do-in-this-lessson">LEFT TO DO IN THIS LESSSON</a></li>
  <li><a href="#visualize-precipitation-data---2013-boulder-flood" id="markdown-toc-visualize-precipitation-data---2013-boulder-flood">Visualize Precipitation Data - 2013 Boulder Flood</a></li>
  <li><a href="#about-the-precipitation-data" id="markdown-toc-about-the-precipitation-data">About the Precipitation Data</a></li>
  <li><a href="#more-about-the-data---where-to-get-it-how-to-get-it-etc" id="markdown-toc-more-about-the-data---where-to-get-it-how-to-get-it-etc">More about the data - where to get it, how to get it, etc.</a></li>
  <li><a href="#import-precipitation-data" id="markdown-toc-import-precipitation-data">Import Precipitation Data</a></li>
  <li><a href="#about-the-data-structure" id="markdown-toc-about-the-data-structure">About the Data Structure</a>    <ul>
      <li><a href="#units" id="markdown-toc-units">Units</a></li>
    </ul>
  </li>
  <li><a href="#interactive-plots---plotly" id="markdown-toc-interactive-plots---plotly">Interactive Plots - Plot.ly</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<p>Several factors contributed to extreme flooding that occured in Boulder, Colorado 
in 2013. In this lesson, we will explore two key variables including:</p>

<ul>
  <li>Precipitation (rainfall) data collected by ???NDCD??</li>
  <li>Stream discharge (or flow) that occured due to combination of the drought 
conditions and extreme rainfall.</li>
</ul>

<div id="objectives">

  <h3 id="goals--objectives">Goals / Objectives</h3>
  <p>After completing this activity, you will:</p>

  <ul>
    <li></li>
  </ul>

  <h3 id="things-youll-need-to-complete-this-lesson">Things You’ll Need To Complete This Lesson</h3>
  <p>Please be sure you have the most current version of <code>R</code> and, preferably,
R studio to write your code.
####R Libraries to Install:</p>

  <ul>
    <li><strong>ggplot2:</strong> <code>install.packages("ggplot2")</code></li>
    <li><strong>lubridate:</strong> <code>install.packages("lubridate")</code></li>
  </ul>

  <h4 id="data-to-download">Data to Download</h4>

  <p><a href="#" class="btn btn-success"> 
#</a></p>

  <p>… processed at <a href="http://www.neoninc.org" target="_blank">NEON </a> 
headquarters. The entire dataset can be accessed by request from the 
<a href="http://www.neoninc.org/data-resources/get-data/airborne-data" target="_blank"> NEON 
website.</a></p>

  <h4 id="recommended-pre-lesson-reading">Recommended Pre-Lesson Reading</h4>

  <h4 id="lesson-series">Lesson Series</h4>

</div>

<h1 id="r-libraries">R Libraries</h1>

<p>We will be working with time-series data in this lesson so we will load the <code>lubridate</code>
library. We will use <code>ggplot2</code> to efficiently plot our data.</p>

<pre><code>library(lubridate) #work with time series data
library(ggplot2)  #create efficient, professional plots
library(plotly) #create cool interactive plots
</code></pre>

<h1 id="about-the-data---usgs-stream-discharge-data">About the Data - USGS Stream Discharge Data</h1>

<p>The USGS has a distributed network of aquatic sensors located in streams across
the United States. These network monitors a suit of variables that are important
to stream morphology and health. One of the metrics that this sensor network monitors is 
<strong>Stream Discharge</strong>, a metric which quantifies the volume of water moving down
a stream. Discharge is an ideal metric to quantify flow, which increases significantly
during a flood event.</p>

<blockquote>
  <p>As defined by USGS: Discharge is the volume of water moving down a stream or 
river per unit of time, 
commonly expressed in cubic feet per second or gallons per day. In general, 
river discharge is computed by multiplying the area of water in a channel cross 
section by the average velocity of the water in that cross section.</p>

  <p><a href="http://water.usgs.gov/edu/streamflow2.html" target="_blank">
More on stream Discharge by USGS.</a></p>
</blockquote>

<figure>
<a href="/images/dist-co-flood/USGS-Peak-discharge.gif">
<img src="/images/dist-co-flood/USGS-Peak-discharge.gif" /></a>
    
<figcaption>
The USGS tracks stream discharge through time at locations across the United 
States. Note the pattern observed in the plot above. The Peak recorded discharge 
value in 2013 was significantly larger than what was observed in other years.
</figcaption>
</figure>

<p>More on USGS streamflow measurements and data:</p>

<ul>
  <li><a href="http://maps.waterdata.usgs.gov/mapper/index.html" target="_blank">
View interactive map of all USGS stations</a></li>
  <li><a href="http://nwis.waterdata.usgs.gov/usa/nwis/peak/?site_no=06730200" target="_blank">
More on peak streamflow. </a></li>
  <li><a href="http://water.usgs.gov/edu/measureflow.html" target="_blank">part 2 - USGS overview
of measuring streamflow</a></li>
  <li><a href="http://water.usgs.gov/edu/streamflow2.html" target="_blank">part 2 - USGS overview
of measuring streamflow</a></li>
</ul>

<p class="notice">NOTE: USGS data can be downloaded via an API (using a command line interface). 
<a href="http://help.waterdata.usgs.gov/faq/automated-retrievals#RT">
More on API downloads of USGS data </a>.</p>

<h1 id="note-its-unclear-from-this-how-the-data-were-actually-measursed-given-it-seems">note: it’s unclear from this how the data were actually measursed given it seems</h1>
<p>there are diferent sensors. ASK Aquatics.</p>

<h2 id="getting-usgs-stream-gauge-data">Getting USGS Stream Gauge Data</h2>

<p>For this lesson, we are using data collected by USGS stream guage 06730200 which 
is located in Boulder Creek at North 75TH ST. This guage is one of the few the 
was able to collect data throughout the 2013 Boulder Floods. The data were that we
will use were downloaded from USGS’s 
<a href="http://waterdata.usgs.gov/nwis" target="_blank"> National 
Water Information System portal </a>.</p>

<p>You can access these data and the full available data stream for the boulder 
guage using the link below. Notice that youare able to download the data at 
different time periods as well!</p>

<p><a href="http://waterdata.usgs.gov/nwis/inventory?agency_code=USGS&amp;site_no=06730200 " target="_blank">View USGS stream guage 06730200 page.</a></p>

<h1 id="insert-picture-of-guage-picture">insert picture of guage! <picture>&gt;</picture></h1>

<h1 id="insert-map-of-where-the-guage-is-located---leaflet">insert map of where the guage is located - leaflet?</h1>

<p>Guage Data info:
USGS 06730200 BOULDER CREEK AT NORTH 75TH ST. NEAR BOULDER, CO
{ : .notice }</p>

<h1 id="import-usgs-stream-discharge-data-into-r">Import USGS Stream Discharge Data Into R</h1>
<p>Now that we better understand the data that we will work with, let’s import it into
<code>R</code>. First, open up the <code>precip-discharge/2013-discharge.txt</code> file in a text editor.
What do you notice about the structure of the file?</p>

<p>The first 25 lines are descriptive text and not actual data. Also notice that 
this file is separated by tabs, not commas. We will need to specify the <strong>Tab delimiter</strong>
when we import our data.We will use the <code>read.csv</code> to import it into an <code>R</code> object.</p>

<p>When we use <code>csv</code> we need to define several attributes of the file including:</p>

<ol>
  <li>The data are tab delimited. We will this tell R to use the <code>"/t"</code> <strong>sep</strong>arator. 
Which defines a tab delimited separation.</li>
  <li>The first group of lines in the file are not data, we will tell <code>R</code> to skip
those lines when it imports the data using <code>skip=25</code>.</li>
  <li>Our data have a header, which is similar to column names in a spreadsheet. We 
will tell <code>R</code> to set <code>header=TRUE</code> to ensure the headers are imported as column
names rather than data values.</li>
  <li>Finally we will set <code>stringsAsFactors = FALSE</code> to ensure our data come in a 
individual values.</li>
</ol>

<p>Let’s import our data.</p>

<pre><code>#SOURCE
#http://nwis.waterdata.usgs.gov/co/nwis/uv/?cb_00065=on&amp;cb_00060=on&amp;format=rdb&amp;site_no=06730200&amp;period=&amp;begin_date=2013-01-01&amp;end_date=2013-12-31
#import data

discharge &lt;- read.csv("precip-discharge/2013-discharge.txt",
                      sep="\t",
                      skip=25,
                      header=TRUE,
                      stringsAsFactors = FALSE)

#view first few lines
head(discharge)

##   agency_cd  site_no         datetime tz_cd X04_00060 X04_00060_cd
## 1        5s      15s              20d    6s       14n          10s
## 2      USGS 06730200 2013-01-01 00:00   MST        22            A
## 3      USGS 06730200 2013-01-01 00:15   MST        22            A
## 4      USGS 06730200 2013-01-01 00:30   MST        22            A
## 5      USGS 06730200 2013-01-01 00:45   MST        22            A
## 6      USGS 06730200 2013-01-01 01:00   MST        22            A
</code></pre>

<p>When we import these data, it appears as if we have 2 header rows rather than one.
Let’s create a new <code>R</code> object that removes the second row of header values. To do
this, we can use select all data beginning at row 2 and ending at the total number
or rows in the file. The <code>nrow</code> function will count the total number of rows in 
the object.</p>

<h1 id="link-out-to-data-or-software-carpentry-lessons-that-teach-this">LINK OUT TO DATA OR SOFTWARE CARPENTRY LESSONS THAT TEACH THIS??</h1>
<ul>
  <li>More on selecting a subset of a data.frame in R</li>
</ul>

<p>Let’s subset our <code>discharge</code> object to remove the first row.</p>

<pre><code>#how many rows are in the R object
nrow(discharge)

## [1] 34257

#remove the first line from the data frame (which is a second list of headers)
#the code below selects all rows beginning at row 2 and ending at the total
#number of rows. 
boulderStrDis.2013 &lt;- discharge[2:nrow(discharge),]
</code></pre>

<p>Now, we have an <code>R</code> object that contains only rows containing data values. Each 
column also has a unique column name. However the column names may not be descriptive
enough. In some cases, when we had useful metadata, we might keep the names as is.
In this case, let’s rename column 5, which contains the discharge value, <strong>disValue</strong>
so it is more “human readable” as we work with it in <code>R</code>.</p>

<pre><code>#view names
names(boulderStrDis.2013)

## [1] "agency_cd"    "site_no"      "datetime"     "tz_cd"       
## [5] "X04_00060"    "X04_00060_cd"

#rename the fifth column to disValue representing discharge value
names(boulderStrDis.2013)[5] &lt;- "disValue"

#view names
names(boulderStrDis.2013)

## [1] "agency_cd"    "site_no"      "datetime"     "tz_cd"       
## [5] "disValue"     "X04_00060_cd"
</code></pre>

<h1 id="view-data-structure">View Data Structure</h1>
<p>Let’s have a look at the structure of our data. It appears as if the discharge 
value is a <code>character</code> class. This is likely because we had an additional row in our
data. Let’s convert the discharge column to a <code>numeric</code> class. In this case, we can 
reassign that column to be of class: <code>integer</code> given there are no decimal places.</p>

<pre><code>#view structure of data
str(boulderStrDis.2013)

## 'data.frame':	34256 obs. of  6 variables:
##  $ agency_cd   : chr  "USGS" "USGS" "USGS" "USGS" ...
##  $ site_no     : chr  "06730200" "06730200" "06730200" "06730200" ...
##  $ datetime    : chr  "2013-01-01 00:00" "2013-01-01 00:15" "2013-01-01 00:30" "2013-01-01 00:45" ...
##  $ tz_cd       : chr  "MST" "MST" "MST" "MST" ...
##  $ disValue    : chr  "22" "22" "22" "22" ...
##  $ X04_00060_cd: chr  "A" "A" "A" "A" ...

#view class of the disValue column
class(boulderStrDis.2013$disValue)

## [1] "character"

#convert column to integer
boulderStrDis.2013$disValue &lt;- as.integer(boulderStrDis.2013$disValue)

class(boulderStrDis.2013$disValue)

## [1] "integer"

str(boulderStrDis.2013)

## 'data.frame':	34256 obs. of  6 variables:
##  $ agency_cd   : chr  "USGS" "USGS" "USGS" "USGS" ...
##  $ site_no     : chr  "06730200" "06730200" "06730200" "06730200" ...
##  $ datetime    : chr  "2013-01-01 00:00" "2013-01-01 00:15" "2013-01-01 00:30" "2013-01-01 00:45" ...
##  $ tz_cd       : chr  "MST" "MST" "MST" "MST" ...
##  $ disValue    : int  22 22 22 22 22 22 22 22 22 22 ...
##  $ X04_00060_cd: chr  "A" "A" "A" "A" ...
</code></pre>

<h1 id="converting-time-stamps">Converting Time Stamps</h1>
<p>We have converted our discharge data to an <code>integer</code> class However the time stamp
field, <code>datetime</code> is still a <code>character</code> class. We could try to plot the data however, 
if we do, it will confuse R. It will read in the dates as character strings and
get confused. Your plot will take a LONG time to render!</p>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/plot-flood-data-example-1.png" alt=" " /></p>

<p>To efficiently plot time series data, let’s convert the <code>datetime</code> column to a 
<code>time</code> class for efficient plotting and analysis.</p>

<pre><code>#view class
class(boulderStrDis.2013$datetime)

## [1] "character"

#convert to date/time class - POSIX
boulderStrDis.2013$datetime &lt;- as.POSIXct(boulderStrDis.2013$datetime)

#recheck data structure
str(boulderStrDis.2013)

## 'data.frame':	34256 obs. of  6 variables:
##  $ agency_cd   : chr  "USGS" "USGS" "USGS" "USGS" ...
##  $ site_no     : chr  "06730200" "06730200" "06730200" "06730200" ...
##  $ datetime    : POSIXct, format: "2013-01-01 00:00:00" "2013-01-01 00:15:00" ...
##  $ tz_cd       : chr  "MST" "MST" "MST" "MST" ...
##  $ disValue    : int  22 22 22 22 22 22 22 22 22 22 ...
##  $ X04_00060_cd: chr  "A" "A" "A" "A" ...
</code></pre>

<h1 id="no-data-values">No Data Values</h1>
<p>Next, let’s query our data to check whether there are no data values (<code>NA</code>) in it.</p>

<pre><code>#make sure there are no null values in our datetime field
sum(is.na(boulderStrDis.2013$datetime ))

## [1] 0
</code></pre>

<h1 id="plot-the-data">Plot The Data</h1>
<p>Finally, we are ready to plot our data. We will use <code>GGPLOT</code> to create our plot.</p>

<pre><code>ggplot(boulderStrDis.2013, aes(datetime, disValue)) +
  geom_point() +
  ggtitle("Stream Discharge (CFS) for Boulder Creek\nJan. 2013-Jan. 2014") +
  xlab("Date (POSIX Time Class)") + ylab("Discharge (Cubic Feet per Second")
</code></pre>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/plot-flood-data-1.png" alt=" " /></p>

<h1 id="plot-data-time-subsets-with-ggplot">Plot Data Time Subsets With GGplot</h1>

<p>We can plot a subset of our data using <code>GGPLOT</code>. Let’s plot data for the months 
directly around the boulder flood: August 2013 - October 2013.</p>

<pre><code>#Define Start and end times for the subset as R objects that are the time class
startTime &lt;- as.POSIXct("2013-08-15 00:00:00")
endTime &lt;- as.POSIXct("2013-10-15 00:00:00")

#create a start and end time R object
start.end &lt;- c(startTime,endTime)
start.end

## [1] "2013-08-15 MDT" "2013-10-15 MDT"
</code></pre>

<h2 id="plot-a-temporal-subset">Plot A Temporal Subset</h2>

<p>Finally, we can use GGPLOT just like we did above to create a new plot. However, 
this time, we will use the <code>scale_x_datetime</code> method and define the limits to our
<code>limits</code> object.</p>

<p>ggtitle(“Stream Discharge (CFS) for Boulder Creek\nJan. 2013-Jan. 2014”) +
  xlab(“Date”) + ylab(“Discharge (Cubic Feet per Second”)</p>

<pre><code>#plot the data - September-October
ggplot(data=boulderStrDis.2013,
      aes(datetime,disValue)) +
      geom_point() +
      scale_x_datetime(limits=start.end) +
      xlab("Time") + ylab("Stream Discharge CFS") +
      ggtitle("Stream Discharge (CFS) for Boulder Creek\nAugust 2013 - October 2013")
</code></pre>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/plot-subset-1.png" alt=" " /></p>

<h1 id="publish-to-plotly">Publish to Plot.ly</h1>
<p>We have now successfully created a plot. We can turn that plot into an interactive
plot using <code>Plot.ly</code> if we want. Note, for this to be successful you need to 
set your Plot.ly API key which you will get from your free online account, once 
you create it.</p>

<p>Set your username: <code>Sys.setenv("plotly_username"="yourUserNameHere")</code>
Set your user key: <code>Sys.setenv("plotly_api_key"="yourUserKeyHere")</code></p>

<h2 id="time-subsets-in-plotly">Time subsets in plot.ly</h2>

<p>Note that plot.ly doesn’t accept the ggplot time subset method. Thus we will
have to manually subset out our data.</p>

<pre><code>library(plotly)

#set username
Sys.setenv("plotly_username"="yourUserNameHere")
#set user key
Sys.setenv("plotly_api_key"="yourUserKeyHere")

#subset out some of the data - July-November
boulderStrDis.aug.oct2013 &lt;- subset(boulderStrDis.2013, 
                        datetime &gt;= as.POSIXct('2013-08-15 00:00',
                                              tz = "America/Denver") &amp; 
                        datetime &lt;= as.POSIXct('2013-10-15 23:59', 
                                              tz = "America/Denver"))

#plot the data - September-October
disPlot.plotly &lt;- ggplot(data=boulderStrDis.aug.oct2013,
        aes(datetime,disValue)) +
        geom_point(size=3) 
      
#add title and labels
disPlot.plotly &lt;- disPlot.plotly + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Stream Discharge CFS") +
          ggtitle("Stream Discharge - Boulder Creek 2013")

#view plotly plot in R
ggplotly()

#publish plotly plot to your plot.ly online account if you want. 
#plotly_POST(disPlot.plotly)
</code></pre>

<h1 id="challenge-">Challenge ???</h1>
<ul>
  <li>Maybe have them grab data from another location - possibly another guage that
survived the flood in another area??</li>
</ul>

<h1 id="left-to-do-in-this-lessson">LEFT TO DO IN THIS LESSSON</h1>
<ol>
  <li>Create Plot.ly plot in a neondataskills account and embed it as a graphic</li>
  <li>Create challenge?</li>
</ol>

<h1 id="visualize-precipitation-data---2013-boulder-flood">Visualize Precipitation Data - 2013 Boulder Flood</h1>

<p>The heavy precipitation (rain) that occurred in September 2013 drove the many of 
the flood impacts including increased <strong>stream discharge (flow)</strong>. Let’s explore
precipitation data collected during this time to better understand this important 
flood driver.</p>

<h1 id="about-the-precipitation-data">About the Precipitation Data</h1>

<p>These data were collected by the National Climatic Data Center - another data provider
that, like USGS has a network of sensors located across the United States collecting
climatic data including temperature and precipitation.</p>

<h1 id="more-about-the-data---where-to-get-it-how-to-get-it-etc">More about the data - where to get it, how to get it, etc.</h1>

<h1 id="import-precipitation-data">Import Precipitation Data</h1>

<p>We will use the <code>precip-discharge/2013-precip-data-640457.csv</code> file in this activity.
These data were downloaded from the NCDC portal… more</p>

<p>After quickly looking at our data, we see that they are separated or delimited by
a comma <code>,</code>. We can use <code>read.csv</code> to import comma separated data. After we import
the data, let’s have a look at the <code>head</code> (which defaults to the first 6 lines) 
of the <code>data.frame</code>. Then, let’s explore the object structure.</p>

<pre><code>#import precip data into R data.frame
precip.boulder &lt;- read.csv("precip-discharge/2013-precip-data-640457.csv",
                           stringsAsFactors = FALSE,
                           header = TRUE)
#view first 6 lines of the data
head(precip.boulder)

##       STATION    STATION_NAME ELEVATION LATITUDE LONGITUDE           DATE
## 1 COOP:050843 BOULDER 2 CO US    1650.5  40.0338 -105.2811 20130101 01:00
## 2 COOP:050843 BOULDER 2 CO US    1650.5  40.0338 -105.2811 20130128 16:00
## 3 COOP:050843 BOULDER 2 CO US    1650.5  40.0338 -105.2811 20130129 01:00
## 4 COOP:050843 BOULDER 2 CO US    1650.5  40.0338 -105.2811 20130201 01:00
## 5 COOP:050843 BOULDER 2 CO US    1650.5  40.0338 -105.2811 20130214 16:00
## 6 COOP:050843 BOULDER 2 CO US    1650.5  40.0338 -105.2811 20130220 18:00
##   HPCP
## 1    0
## 2   10
## 3   10
## 4    0
## 5   10
## 6   10

#view structure of data
str(precip.boulder)

## 'data.frame':	233 obs. of  7 variables:
##  $ STATION     : chr  "COOP:050843" "COOP:050843" "COOP:050843" "COOP:050843" ...
##  $ STATION_NAME: chr  "BOULDER 2 CO US" "BOULDER 2 CO US" "BOULDER 2 CO US" "BOULDER 2 CO US" ...
##  $ ELEVATION   : num  1650 1650 1650 1650 1650 ...
##  $ LATITUDE    : num  40 40 40 40 40 ...
##  $ LONGITUDE   : num  -105 -105 -105 -105 -105 ...
##  $ DATE        : chr  "20130101 01:00" "20130128 16:00" "20130129 01:00" "20130201 01:00" ...
##  $ HPCP        : int  0 10 10 0 10 10 10 10 10 10 ...
</code></pre>

<h1 id="about-the-data-structure">About the Data Structure</h1>
<p>Viewing the structure of these data, we can see that a few potential issues with 
the data. The date field is in a character class.</p>

<pre><code>#convert date time
precip.boulder$DATE &lt;- as.POSIXct(precip.boulder$DATE,
                                  format="%Y%m%d %H:%M")

#clean up no data values
precip.boulder$HPCP[precip.boulder$HPCP==99999] &lt;- NA

#plot the data - September-October
precPlot &lt;- ggplot(data=precip.boulder,
      aes(DATE,HPCP)) +
      geom_bar(stat="identity") +
      scale_x_datetime(limits=limits) +
      scale_y_continuous(limits = c(0, 300))
      
#add title and labels
precPlot + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Precipitation (100th of an inch)") +
          ggtitle("Hourly Precipitation - Boulder - Station\n Boulder Creek 2013")

## Warning: Removed 4 rows containing missing values (position_stack).
</code></pre>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/unnamed-chunk-1-1.png" alt=" " /></p>

<pre><code>library(plyr)
#add a day column in the data frame
precip.boulder$daily &lt;- floor_date(precip.boulder$DATE, "day")

#summarize by day
dailyPrecip.boulder &lt;- ddply(precip.boulder, "daily",summarise, x=sum(HPCP))

names(dailyPrecip.boulder)

## [1] "daily" "x"

#let's create a more meaningful column header for the precip value
names(dailyPrecip.boulder) &lt;- c("day","prec_100In")

# view names
names(dailyPrecip.boulder)

## [1] "day"        "prec_100In"

#are there no data values?
sum(is.na(dailyPrecip.boulder))

## [1] 4

#remove rows with no data
dailyPrecip.boulder.cln &lt;- na.omit(dailyPrecip.boulder)

#plot the data - September-October
precPlot &lt;- ggplot(data=dailyPrecip.boulder.cln,
      aes(day,prec_100In)) +
       geom_bar(stat="identity") +
      scale_x_datetime(limits=limits) +
      scale_y_continuous(limits = c(0, 800))
      
#add title and labels
precPlot + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Precipitation (100th of an inch)") +
          ggtitle("DAILY Precipitation - Boulder- Station\n Boulder Creek 2013")
</code></pre>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/daily-summaries-1.png" alt=" " /></p>

<h2 id="units">Units</h2>

<p>It looks like our precipitation data are in 100th of an inch. Let’s convert the 
data to inches - units that we might be a bit more accustomed to. And then let’s
plot the data as a bar plot rather than a scatter plot.</p>

<pre><code>#convert to inches
dailyPrecip.boulder.cln$prec_in &lt;- dailyPrecip.boulder.cln$prec_100In / 100

head(dailyPrecip.boulder.cln)

##          day prec_100In prec_in
## 1 2013-01-01          0     0.0
## 2 2013-01-28         10     0.1
## 3 2013-01-29         10     0.1
## 4 2013-02-01          0     0.0
## 5 2013-02-14         10     0.1
## 6 2013-02-20         20     0.2

#plot the data - September-October
precPlot_2013 &lt;- ggplot(data=dailyPrecip.boulder.cln,
      aes(day,prec_in)) +
      geom_bar(stat="identity") +
      scale_x_datetime() +
      scale_y_continuous(limits = c(0, 8))
      
#add title and labels
precPlot_2013 &lt;- precPlot_2013 + theme(axis.title.x = element_blank()) +
          xlab("2013") + ylab("Precipitation (Inches)") +
          ggtitle("Daily Total Precipitation (Inches) - Boulder- Station\n Boulder Creek 2013")


precPlot_2013
</code></pre>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/convert-units-1.png" alt=" " /></p>

<pre><code>#plot the data - September-October
precPlot &lt;- ggplot(data=dailyPrecip.boulder.cln,
      aes(day,prec_in)) +
      geom_bar(stat="identity") +
      scale_x_datetime(limits=limits) +
      scale_y_continuous(limits = c(0, 8))
      
#add title and labels
precPlot &lt;- precPlot + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Precipitation (inches)") +
          ggtitle("Daily Total Precipitation (Inches) - Boulder- Station\n Boulder Creek 2013")


precPlot
</code></pre>

<p><img src="/images/rfigs/2015-12-03-Boulder-Flood-Precipitation-Time-Series-Data-In-R/convert-units-2.png" alt=" " /></p>

<h1 id="interactive-plots---plotly">Interactive Plots - Plot.ly</h1>

<p>Let’s turn our plot into an interactive plot.ly plot</p>

<pre><code>library(plotly)
#setup your plot.ly credentials
Sys.setenv("plotly_username"="your.user.name.here")
Sys.setenv("plotly_api_key"="your.key.here")

#subset out some of the data - July-November
dailyPrec.sub &lt;- subset(dailyPrecip.boulder.cln, 
                        day &gt;= as.POSIXct('2013-08-15 00:00',
                        tz = "America/New_York") &amp; day &lt;=
        as.POSIXct('2013-10-15 23:59', tz = "America/Denver"))


#create new plot
new &lt;- ggplot(data=dailyPrec.sub, aes(day,prec_in)) +
  geom_bar(stat="identity") +
  xlab("Time") + ylab("Precipitation (inches)") +
  ggtitle("Daily Total Precipitation (Inches) - Boulder Creek 2013") 

#view plotly plot in R
ggplotly()
</code></pre>

<!--html_preserve-->
<div id="htmlwidget-434" style="width:504px;height:504px;" class="plotly"></div>
<script type="application/json" data-for="htmlwidget-434">{"x":{"data":[{"x":[1377064800000,1377496800000,1378015200000,1378706400000,1378792800000,1378879200000,1378965600000,1379052000000,1379138400000,1379224800000,1379311200000,1379829600000,1379916000000,1380261600000,1380607200000,1380780000000,1380866400000,1381384800000],"y":[0.1,0.2,0,0.8,0.3,6.4,7.3,0.3,0.1,1.6,0.1,0.1,0.3,0.4,0,0.2,0.7,0.1],"type":"bar","text":[null],"name":{},"marker":{"color":{}},"xaxis":"x1","yaxis":"y1","showlegend":false,"bargap":"default","barmode":"stack"}],"layout":{"barmode":"stack","xaxis":{"tickcolor":"rgb(127,127,127)","gridcolor":"rgb(255,255,255)","showgrid":true,"ticks":"outside","showticklabels":true,"type":"date","title":"Time","zeroline":false,"showline":false},"yaxis":{"tickcolor":"rgb(127,127,127)","gridcolor":"rgb(255,255,255)","showgrid":true,"ticks":"outside","showticklabels":true,"type":"linear","title":"Precipitation (inches)","zeroline":false,"showline":false},"title":"Daily Total Precipitation (Inches) - Boulder Creek 2013","plot_bgcolor":"rgb(229,229,229)","margin":{"b":40,"l":60,"t":25,"r":10},"legend":{"bordercolor":"transparent","x":1.01,"y":0.4875,"xref":"paper","yref":"paper","xanchor":"left","yanchor":"top","font":{"family":""},"bgcolor":"rgb(255,255,255)"},"showlegend":false,"titlefont":{"family":""},"paper_bgcolor":"rgb(255,255,255)"},"world_readable":true},"evals":[]}</script>
<!--/html_preserve-->

<pre><code>#publish plotly plot to your plot.ly online account when you are happy with it
plotly_POST(new)

## Error in curl::curl_fetch_memory(url, handle = handle): Peer certificate cannot be authenticated with given CA certificates
</code></pre>

